<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/styles.css" />
    <link rel="stylesheet" href="./css/register-and-login.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <title>¿Who Knows?</title>
  </head>

  <body>
    <div class="navigation">
      <nav>
        <h3><a id="nav-logo" href="/">¿Who Knows?</a></h3>
        <div class="navigation-links">
          <a id="nav-weather" href="/weather">Weather</a>
          <a id="nav-logout" href="/api/logout">Log out</a>
          <a id="nav-register" href="/register">Register</a>
          <a id="nav-login" href="/login">Log in</a>
        </div>
      </nav>
    </div>

    <form
      id="loginForm"
      class="register-container"
      action="/api/login"
      method="POST"
    >
      <label>
        Username:
        <input type="text" name="username" required />
      </label>
      <label>
        Password:
        <input
          type="password"
          name="password"
          required
          autocomplete="current-password"
        />
      </label>

      <p id="errorMessage" style="color: red; display: none"></p>
      <button type="submit">Login</button>
    </form>

    <footer class="footer">
      <span>¿Who Knows? © 2009</span>
      <a href="/about">about</a>
    </footer>
  </body>
  <script src="js/index.js"></script>
  <script>
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const errorMessage = document.getElementById("errorMessage");

      let responseStatus; // Gem response status her

      fetch("/api/login", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          username: formData.get("username"),
          password: formData.get("password"),
        }),
      })
        .then((response) => {
          responseStatus = response.ok; // Gem response.ok
          return response.json();
        })
        .then((data) => {
          if (responseStatus) {
            // Brug den gemte status
            // Login successful
            window.location.href = "/";
          } else {
            // Show error message
            errorMessage.textContent = data.error || "Login failed";
            errorMessage.style.display = "block";
          }
        })
        .catch((error) => {
          errorMessage.textContent = "Error connecting to server";
          errorMessage.style.display = "block";
          console.error("Error:", error);
        });
    });
  </script>
</html>
